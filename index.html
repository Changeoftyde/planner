<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Upcoming Planner</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @keyframes fade-in { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
  .animate-fade-in { animation: fade-in 0.25s ease-out; }
  .month-zoom { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.2); overflow:auto; display:flex; justify-content:center; align-items:flex-start; padding:2rem; z-index:50; }
  .completed { opacity: 0.35; text-decoration: line-through; filter: grayscale(0.8); }
  .past-month { opacity: 0.5; filter: grayscale(0.4); }
</style>
</head>
<body class="bg-gradient-to-br from-sky-100 to-indigo-200 min-h-screen flex flex-col items-center p-6">

<h1 class="text-4xl font-bold mb-4 text-indigo-700">üìÖ My Upcoming Planner</h1>

<div class="flex items-center gap-4 mb-6">
  <button id="prevYear" class="bg-indigo-500 text-white px-4 py-2 rounded-xl hover:bg-indigo-600">‚Üê Prev</button>
  <h2 id="yearLabel" class="text-2xl font-semibold text-indigo-700"></h2>
  <button id="nextYear" class="bg-indigo-500 text-white px-4 py-2 rounded-xl hover:bg-indigo-600">Next ‚Üí</button>
</div>

<div id="calendarContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-6xl"></div>

<!-- Zoomed month modal -->
<div id="monthZoom" class="hidden month-zoom">
  <div id="zoomContent" class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-4xl animate-fade-in overflow-auto"></div>
</div>

<!-- Event modal -->
<div id="modal" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm flex justify-center items-center">
  <div class="bg-white rounded-2xl shadow-lg p-6 w-96 animate-fade-in">
    <h2 class="text-2xl font-semibold mb-4 text-indigo-700">Event</h2>
    <input id="titleInput" class="w-full border p-2 rounded mb-3" placeholder="Event title" />
    <input id="dateInput" type="date" class="w-full border p-2 rounded mb-3" />
    <textarea id="descInput" class="w-full border p-2 rounded mb-3" placeholder="Description"></textarea>
    <div class="flex items-center justify-between mb-4">
      <label class="font-semibold">Color:</label>
      <input id="colorInput" type="color" class="w-10 h-10 border rounded-full cursor-pointer" />
    </div>
    <div class="flex justify-between">
      <button id="saveBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-xl hover:bg-indigo-700">Save</button>
      <button id="closeBtn" class="bg-gray-300 px-4 py-2 rounded-xl hover:bg-gray-400">Close</button>
    </div>
  </div>
</div>

<script>
const calendarContainer = document.getElementById("calendarContainer");
const modal = document.getElementById("modal");
const titleInput = document.getElementById("titleInput");
const dateInput = document.getElementById("dateInput");
const descInput = document.getElementById("descInput");
const colorInput = document.getElementById("colorInput");
const saveBtn = document.getElementById("saveBtn");
const closeBtn = document.getElementById("closeBtn");
const yearLabel = document.getElementById("yearLabel");
const nextYearBtn = document.getElementById("nextYear");
const prevYearBtn = document.getElementById("prevYear");
const monthZoom = document.getElementById("monthZoom");
const zoomContent = document.getElementById("zoomContent");

let events = JSON.parse(localStorage.getItem("plannerEvents") || "[]");
const baseYear = new Date().getFullYear();
let currentYear = baseYear;
let editingIndex = null;
let hideCompleted = JSON.parse(localStorage.getItem("hideCompleted")) ?? false;

const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

function getFullYearLoopMonths() {
  const today = new Date();
  const start = today.getMonth();
  const result = [];
  for (let i = 0; i < 12; i++) result.push((start + i) % 12);
  return result;
}

function renderYear(year) {
  calendarContainer.innerHTML = "";
  yearLabel.textContent = year;
  const today = new Date();
  const todayStr = today.toISOString().split('T')[0];
  const currentMonth = today.getMonth();

  const allMonths = getFullYearLoopMonths();
  allMonths.forEach(monthIndex => {
    let displayYear = year;
    if (monthIndex < currentMonth && year === baseYear) displayYear = year + 1;

    const monthDiv = document.createElement("div");
    monthDiv.className = "bg-white shadow-xl rounded-2xl p-4 cursor-pointer hover:scale-105 transition-all";

    const isPastMonth = (year === baseYear && monthIndex < currentMonth);
    if (isPastMonth) monthDiv.classList.add("past-month");

    const title = document.createElement("h3");
    title.textContent = `${months[monthIndex]} ${displayYear}`;
    title.className = "text-xl font-semibold text-indigo-700 mb-3";
    monthDiv.appendChild(title);

    const grid = document.createElement("div");
    grid.className = "grid grid-cols-7 gap-1 text-sm";

    const firstDay = new Date(displayYear, monthIndex, 1);
    const lastDay = new Date(displayYear, monthIndex + 1, 0);
    const startDay = firstDay.getDay();
    const totalDays = lastDay.getDate();

    for (let i = 0; i < startDay; i++) grid.appendChild(document.createElement("div"));

    for (let day = 1; day <= totalDays; day++) {
      const dateStr = `${displayYear}-${String(monthIndex+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
      const cell = document.createElement("div");
      cell.className = "p-2 rounded-xl hover:bg-indigo-50 transition-all cursor-pointer";
      if (dateStr === todayStr) cell.classList.add("bg-yellow-200");

      const num = document.createElement("div");
      num.textContent = day;
      num.className = "font-semibold text-indigo-700 text-center";
      cell.appendChild(num);

      const dayEvents = events.filter(e => e.date === dateStr && (!hideCompleted || !e.completed));
      dayEvents.forEach(ev => {
        const tag = document.createElement("div");
        tag.className = `mt-1 text-white text-xs rounded px-2 py-1 truncate text-center ${ev.completed ? "completed" : ""}`;
        tag.style.backgroundColor = ev.color;
        tag.textContent = ev.title;
        cell.appendChild(tag);
      });

      cell.onclick = (e) => { e.stopPropagation(); openDayEvents(dateStr); };
      grid.appendChild(cell);
    }

    monthDiv.appendChild(grid);
    monthDiv.onclick = () => openMonthZoom(monthIndex, displayYear);
    calendarContainer.appendChild(monthDiv);
  });

  prevYearBtn.disabled = year <= baseYear - 1;
  prevYearBtn.classList.toggle("opacity-40", prevYearBtn.disabled);
}

function openMonthZoom(monthIndex, year) {
  zoomContent.innerHTML = "";
  const monthTitle = document.createElement("h2");
  monthTitle.textContent = `${months[monthIndex]} ${year}`;
  monthTitle.className = "text-2xl font-bold mb-4 text-indigo-700";
  zoomContent.appendChild(monthTitle);

  const toggleBtn = document.createElement("button");
  toggleBtn.textContent = hideCompleted ? "Show Completed" : "Hide Completed";
  toggleBtn.className = "mb-4 bg-gray-300 px-4 py-2 rounded-xl hover:bg-gray-400";
  toggleBtn.onclick = () => { hideCompleted = !hideCompleted; saveHideState(); openMonthZoom(monthIndex, year); };
  zoomContent.appendChild(toggleBtn);

  const grid = document.createElement("div");
  grid.className = "grid grid-cols-7 gap-1 text-sm";

  const today = new Date();
  const todayStr = today.toISOString().split('T')[0];
  const firstDay = new Date(year, monthIndex, 1);
  const totalDays = new Date(year, monthIndex + 1, 0).getDate();
  const startDay = firstDay.getDay();

  for (let i = 0; i < startDay; i++) grid.appendChild(document.createElement("div"));
  for (let day = 1; day <= totalDays; day++) {
    const dateStr = `${year}-${String(monthIndex+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    const cell = document.createElement("div");
    cell.className = "p-3 rounded-xl bg-white shadow hover:bg-indigo-50 cursor-pointer transition-all";
    if (dateStr === todayStr) cell.classList.add("bg-yellow-200");

    const num = document.createElement("div");
    num.textContent = day;
    num.className = "font-semibold text-indigo-700 text-center";
    cell.appendChild(num);

    const dayEvents = events.filter(e => e.date === dateStr && (!hideCompleted || !e.completed));
    dayEvents.forEach(ev => {
      const tag = document.createElement("div");
      tag.className = `mt-1 text-white text-xs rounded px-2 py-1 truncate text-center ${ev.completed ? "completed" : ""}`;
      tag.style.backgroundColor = ev.color;
      tag.textContent = ev.title;
      cell.appendChild(tag);
    });

    cell.onclick = (e) => { e.stopPropagation(); openDayEvents(dateStr); };
    grid.appendChild(cell);
  }

  zoomContent.appendChild(grid);
  monthZoom.classList.remove("hidden");
}

function openDayEvents(dateStr) {
  const dayEvents = events.filter(e => e.date === dateStr);
  zoomContent.innerHTML = "";

  const dayTitle = document.createElement("h2");
  dayTitle.textContent = `Events on ${dateStr}`;
  dayTitle.className = "text-2xl font-bold mb-4 text-indigo-700";
  zoomContent.appendChild(dayTitle);

  const toggleBtn = document.createElement("button");
  toggleBtn.textContent = hideCompleted ? "Show Completed" : "Hide Completed";
  toggleBtn.className = "mb-4 bg-gray-300 px-4 py-2 rounded-xl hover:bg-gray-400";
  toggleBtn.onclick = () => { hideCompleted = !hideCompleted; saveHideState(); openDayEvents(dateStr); };
  zoomContent.appendChild(toggleBtn);

  const list = document.createElement("div");
  list.className = "flex flex-col gap-3 mb-4";

  dayEvents.filter(e => !hideCompleted || !e.completed).forEach(ev => {
    const evDiv = document.createElement("div");
    evDiv.className = `bg-white p-3 rounded-xl shadow flex justify-between items-center ${ev.completed ? "completed" : ""}`;

    const info = document.createElement("div");
    const title = document.createElement("div");
    title.textContent = ev.title;
    title.className = "font-semibold text-indigo-700";
    const desc = document.createElement("div");
    desc.textContent = ev.desc;
    desc.className = "text-sm text-gray-600";
    info.appendChild(title);
    info.appendChild(desc);

    const controls = document.createElement("div");

    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.className = "bg-indigo-500 text-white px-2 py-1 rounded mr-2 hover:bg-indigo-600";
    editBtn.onclick = (e) => { e.stopPropagation(); openEditModal(ev); };

    const completeBtn = document.createElement("button");
    completeBtn.textContent = ev.completed ? "Undo" : "Complete";
    completeBtn.className = "bg-green-500 text-white px-2 py-1 rounded mr-2 hover:bg-green-600";
    completeBtn.onclick = (e) => { e.stopPropagation(); toggleComplete(ev); };

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.className = "bg-rose-500 text-white px-2 py-1 rounded hover:bg-rose-600";
    delBtn.onclick = (e) => { e.stopPropagation(); deleteEvent(ev); };

    controls.append(editBtn, completeBtn, delBtn);
    evDiv.append(info, controls);
    list.appendChild(evDiv);
  });

  zoomContent.appendChild(list);

  const addBtn = document.createElement("button");
  addBtn.textContent = "Add New Event";
  addBtn.className = "bg-indigo-600 text-white px-4 py-2 rounded-xl hover:bg-indigo-700";
  addBtn.onclick = () => openModal(dateStr);
  zoomContent.appendChild(addBtn);
}

function openModal(dateStr) {
  editingIndex = null;
  titleInput.value = "";
  descInput.value = "";
  dateInput.value = dateStr;
  colorInput.value = "#4f46e5";
  modal.classList.remove("hidden");

  saveBtn.onclick = () => {
    const newEvent = { title: titleInput.value, date: dateInput.value, desc: descInput.value, color: colorInput.value, completed: false };
    events.push(newEvent);
    saveAndRender(dateInput.value);
    modal.classList.add("hidden");
  };
}

function openEditModal(ev) {
  editingIndex = events.indexOf(ev);
  titleInput.value = ev.title;
  descInput.value = ev.desc;
  dateInput.value = ev.date;
  colorInput.value = ev.color;
  modal.classList.remove("hidden");

  saveBtn.onclick = () => {
    events[editingIndex] = { ...ev, title: titleInput.value, desc: descInput.value, date: dateInput.value, color: colorInput.value };
    saveAndRender(dateInput.value);
    modal.classList.add("hidden");
  };
}

function toggleComplete(ev) {
  ev.completed = !ev.completed;
  saveAndRender(ev.date);
}

function deleteEvent(ev) {
  events = events.filter(e => e !== ev);
  saveAndRender(ev.date);
}

function saveHideState() {
  localStorage.setItem("hideCompleted", JSON.stringify(hideCompleted));
}

function saveAndRender(dateStr) {
  localStorage.setItem("plannerEvents", JSON.stringify(events));
  renderYear(currentYear);
  openMonthZoom(new Date(dateStr).getMonth(), new Date(dateStr).getFullYear());
}

closeBtn.onclick = () => modal.classList.add("hidden");
monthZoom.onclick = () => monthZoom.classList.add("hidden");

nextYearBtn.onclick = () => { currentYear++; renderYear(currentYear); };
prevYearBtn.onclick = () => { if (currentYear > baseYear - 1) { currentYear--; renderYear(currentYear); } };

renderYear(currentYear);
</script>
</body>
</html>
